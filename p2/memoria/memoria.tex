\documentclass[a4paper, 12pt, spanish]{memoria}

\usepackage{si2}
\ConfigurarDocumento{
	practica = {2}{Práctica 2: Rendimiento},
}

\usepackage{booktabs}
\usepackage{pgfplotstable}
\pgfplotsset{compat=1.8}

\newcommand{\TableAggregateCsv}[2][]{{
\pgfplotstabletypeset[%
	% booktabs
	every head row/.style={before row={\toprule},after row={\midrule}},
	every last row/.style={after row=\bottomrule},
	% formatos
	/pgf/number format/fixed numeric/.style={
		/pgfplots/table/numeric type,
		fixed,
		precision=#1,
		fixed zerofill
	},
	/pgfplots/table/create col/format percent/.style={
		/pgfplots/table/multiply by=100,
		postproc cell content/.append style={
			/pgfplots/table/@cell content/.add={}{$\%$},
		},
	}
	font={\footnotesize},
	% especifico a la tabla
	ignore chars={\%},col sep=comma,
	columns/sampler_label/.style             	= {column name={Nombre},string type,column type=l       	},
	columns/aggregate_report_count/.style    	= {column name={Muestras}                               	},
	columns/average/.style                   	= {column name={Media}                                  	},
	columns/aggregate_report_median/.style   	= {column name={Mediana}                                	},
	columns/aggregate_report_90_line/.style  	= {column name={P-$90\%$}                               	},
	columns/aggregate_report_min/.style      	= {column name={Mín}                                    	},
	columns/aggregate_report_max/.style      	= {column name={Máx}                                    	},
	columns/aggregate_report_error/.style    	= {column name={Error \%},fixed numeric=1,format percent	},
	columns/aggregate_report_rate/.style     	= {column name={Rate},fixed numeric=2                   	},
	columns/aggregate_report_bandwidth/.style	= {column name={Bandwidth},fixed numeric=2              	},
	#1
	]{#2}
}}

\newcommand{\comando}[1]{\texttt{#1}}

% =========================================================================================================
\begin{document}

\portada\indice

\bloque[1]{Mediciones de rendimiento con JMeter}

\ejercicio[1]{Definición del plan de pruebas}
Hemos definido el plan completo de pruebas y hemos adjuntado el fichero generado \fichero{P2.jmx} al entregable de la práctica.

Para evitar repetición, hemos comprobado que se podría mover la variable aleatorio y el set de datos CSV un nivel superior. 

\ejercicio[2]{Uso de \texttt{free} y \texttt{nmon}}
Hemos preparado los PCs con el servidor en \codigo{10.1.11.1} y el cliente en \codigo{10.1.11.2}.

%% (Salida del comando free)
%\includegraphics{path/al.png}
%% (Salida del comando nmon)
%\includegraphics{path/al.png}

\ejercicio[3]{Ejecutando las pruebas}
% TODO: Insertar foto verificando que los pagos son correctos?
% Anote los resultados del informe agregado en la memoria de la práctica.
A continuación están los resultados del informe agregado:
\begin{table}[h!]
	\centering
	\caption{Informe de P1-base, P1-ws y P1-ejb-remoto}
	\TableAggregateCsv{aggregate.csv}
\end{table}

\pregunta[1]{¿Cuál de los resultados le parece el mejor? ¿Por qué?}
La implementación de P1-base parece ser la más eficiente en términos de rendimiento.
\pregunta[2]{¿Qué columna o columnas elegiría para decidir este resultado?}
Son preferibles estadísticos robustos a los que les afecte menos el ruido (eg, la mediana en vez de la medía).
Mediana, P90\%.

\begin{table}[h!]
	\centering
	\caption{Informe de P1-ejb}
	\TableAggregateCsv{aggregate2.csv}
\end{table}
% Compare los resultados obtenidos con los anteriores.
El rendimiento del P1-ejb local es considerablemente mejor que la versión con el ejb local.

\bloque[2]{Monitorización}

\ejercicio[4]{Adaptando la configuración del servidor}

\pregunta[1]{Revisar el script \comando{si2-monitor.sh} e indicar los mandatos \comando{asadmin} que debemos ejecutar en el Host PC1 para averiguar el Max Queue Size del Servicio HTTP y el Maximum Pool Size de la DB.}

\ejercicio[5]{Valores de configuración de Glassfish}
Esta en la hoja de calculo.

\ejercicio[6]{Ejecutando las pruebas de nuevo}

\pregunta[1]{A la vista de los resultados, ¿qué elemento de proceso le parece más costosa? ¿Red? ¿CPU? ¿Acceso a datos? En otras palabras, ¿cuál fue el elemento más utilizado durante la monitorización con \comando{nmon} en un entorno virtual? (CPU, Memoria, disco,...)}

\pregunta[2]{¿Le parece una situación realista la simulada en este ejercicio? ¿Por qué?}

\pregunta[3]{Teniendo en cuenta cuál ha sido el elemento más saturado, proponga otro esquema de despliegue que resuelva esa situación.}

\bloque[3]{Curva de productividad para P1-base}

\ejercicio[8]{Curva de productividad}
Las mediciones han sido tomadas un viernes y un lunes por la tarde.

\pregunta{¿Cómo debemos invocar a nmon para recolectar muestras cada 5 segundos durante 10 minutos que incluyan los top processes en el fichero log-file.nmon?}

\bloque[4]{Conclusiones}


\end{document}

